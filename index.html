<!DOCTYPE html>
<html lang="en">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  ul,
  li {
    list-style: none;
  }

  .gam-btn {
    margin: 20px 0;
  }

  .wanj {
    width: 100%;
    display: flex;
    margin-top: 20px;
  }

  .wanj>div {
    width: 200px;
  }

  .wanj-div>h2 {
    display: flex;
  }

  .wanj_span {
    /* font-weight: 100; */
    font-size: 14px;
    color: red;
    display: none;
  }

  .wanjUl {
    cursor: pointer;
  }

  .block {
    display: block;
  }
  .pitchOn {
    background-color: red;
    color: #fff;
  }
</style>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div class="gam-btn">
    <button id="rob" click='robMaster'>抢庄</button>
    <button id="start" data-ng-click="start">发牌</button>
  </div>

  <div class="wanj">
    <div class="wanj-div wanj-1">
      <h2>电脑1<span class="wanj_span isMaster">庄家</span></h2>
      <ul class="wanjUl"></ul>
    </div>
    <div class="wanj-div wanj-2">
      <h2>电脑2<span class="wanj_span isMaster">庄家</span></h2>
      <ul class="wanjUl"></ul>
    </div>
    <div class="wanj-div wanj-3">
      <h2>电脑3<span class="wanj_span isMaster">庄家</span></h2>
      <ul class="wanjUl"></ul>
    </div>
    <div class="wanj-div wanj-1">
      <h2>玩家1<span class="wanj_span isMaster">庄家</span></h2>
      <ul id="selectCrd" class="wanjUl"></ul>
    </div>
  </div>
</body>

<script type="module">
  let data = {}
  let rob = document.querySelector('#rob')
  let start = document.querySelector('#start')
  let isMaster = document.querySelectorAll('.isMaster')
  let wanjUl = document.querySelectorAll('.wanjUl')
  let selectCrd = document.querySelector('#selectCrd')
  let dataArr = []
  let selectDom = []
  function createData() {
    data = {
      "cord": [
        {
          "type": "maxKing",
          "count": "大王"
        },
        {
          "type": "minKing",
          "count": "小王"
        },
        {
          "type": "peach",
          "count": "A"
        },
        {
          "type": "peach",
          "count": "2"
        },
        {
          "type": "peach",
          "count": "3"
        },
        {
          "type": "peach",
          "count": "4"
        },
        {
          "type": "peach",
          "count": "5"
        },
        {
          "type": "peach",
          "count": "6"
        },
        {
          "type": "peach",
          "count": "7"
        },
        {
          "type": "peach",
          "count": "8"
        },
        {
          "type": "peach",
          "count": "9"
        },
        {
          "type": "peach",
          "count": "10"
        },
        {
          "type": "peach",
          "count": "J"
        },
        {
          "type": "peach",
          "count": "Q"
        },
        {
          "type": "peach",
          "count": "K"
        },
        {
          "type": "blackPeach",
          "count": "A"
        },
        {
          "type": "blackPeach",
          "count": "2"
        },
        {
          "type": "blackPeach",
          "count": "3"
        },
        {
          "type": "blackPeach",
          "count": "4"
        },
        {
          "type": "blackPeach",
          "count": "5"
        },
        {
          "type": "blackPeach",
          "count": "6"
        },
        {
          "type": "blackPeach",
          "count": "7"
        },
        {
          "type": "blackPeach",
          "count": "8"
        },
        {
          "type": "blackPeach",
          "count": "9"
        },
        {
          "type": "blackPeach",
          "count": "10"
        },
        {
          "type": "blackPeach",
          "count": "J"
        },
        {
          "type": "blackPeach",
          "count": "Q"
        },
        {
          "type": "blackPeach",
          "count": "K"
        },
        {
          "type": "plum",
          "count": "A"
        },
        {
          "type": "plum",
          "count": "2"
        },
        {
          "type": "plum",
          "count": "3"
        },
        {
          "type": "plum",
          "count": "4"
        },
        {
          "type": "plum",
          "count": "5"
        },
        {
          "type": "plum",
          "count": "6"
        },
        {
          "type": "plum",
          "count": "7"
        },
        {
          "type": "plum",
          "count": "8"
        },
        {
          "type": "blackPeach",
          "count": "9"
        },
        {
          "type": "plum",
          "count": "10"
        },
        {
          "type": "plum",
          "count": "J"
        },
        {
          "type": "plum",
          "count": "Q"
        },
        {
          "type": "plum",
          "count": "K"
        },
        {
          "type": "diamonds",
          "count": "A"
        },
        {
          "type": "diamonds",
          "count": "2"
        },
        {
          "type": "diamonds",
          "count": "3"
        },
        {
          "type": "diamonds",
          "count": "4"
        },
        {
          "type": "diamonds",
          "count": "5"
        },
        {
          "type": "diamonds",
          "count": "6"
        },
        {
          "type": "diamonds",
          "count": "7"
        },
        {
          "type": "diamonds",
          "count": "8"
        },
        {
          "type": "diamonds",
          "count": "9"
        },
        {
          "type": "diamonds",
          "count": "10"
        },
        {
          "type": "diamonds",
          "count": "J"
        },
        {
          "type": "diamonds",
          "count": "Q"
        },
        {
          "type": "diamonds",
          "count": "K"
        }
      ],
      "gamePlayer": [
        {
          "name": "电脑1",
          "master": false,
          "id": 1,
          "card": []
        },
        {
          "name": "电脑2",
          "master": false,
          "id": 2,
          "card": []
        },
        {
          "name": "电脑3",
          "master": false,
          "id": 3,
          "card": []
        },
        {
          "name": "玩家1",
          "master": false,
          "id": 4,
          "card": []
        },
      ]
    }
    selectDom = []
  }
  createData()
  // 数组乱序 (洗牌)
  function shuffle(arr) {
    let b = []
    while (arr.length > 0) {
      let index = parseInt(Math.random() * (arr.length - 1))
      b.push(arr[index])
      arr.splice(index, 1)
    }
    return b
  }

  function setCrad(name) {
    let data = {
      'maxKing': '大王',
      'minKing': '小王',
      'peach': '红桃',
      'blackPeach': '黑桃',
      'plum': '梅花',
      'diamonds': '方块'
    }
    return data[name]
  }

  function hassClass(el, className) {
    let reg = new RegExp('(^|\\s)' + className + '(\\s|$)')
    return reg.test(el.className)
  }

  function addClass(el, className) {
    if (hassClass(el, className)) {
      return
    }
    let newClass = el.className.split(' ')
    newClass.push(className)
    el.className = newClass.join(' ')
  }

  function remClass(el, className) {
    if (!hassClass(el, className)) {
      return
    }
    let rmCl = el.className.split(' ')
    rmCl.splice(rmCl.indexOf(className), 1)
    el.className = rmCl.join(' ')
  }

  function getIsSelect (selectDom, condition) {
    let index = -1
    selectDom.some((v, index1) =>{
      if (v.count === condition.count && v.type === condition.type) {
        index = index1
        return
      }
    })
    return index
  }

  rob.addEventListener('click', () => {
    // 抢庄
    dataArr = shuffle(data.cord)
    let i = Math.round(Math.random() * 3)
    wanjUl.forEach(v => {
      v.innerHTML = ''
    })
    createData()
    isMaster.forEach(v => {
      remClass(v, 'block')
    })
    data.gamePlayer[i].master = true
    addClass(isMaster[i], 'block')
  })

  start.addEventListener('click', () => {
    // 发牌
    let master = []
    master = data.gamePlayer.filter(v => {
      return v.master === true
    })
    if (!master.length) {
      alert('请先抢庄家')
      return
    }
    data.gamePlayer = data.gamePlayer.map(v => {
      while (v.card.length < 5) {
        let item = dataArr.pop()
        if (item.type !== 'maxKing' && item.type !== 'minKing') {
          v.card.push(item)
        }
      }
      return v
    })
    // 将牌加入dom
    wanjUl.forEach((v, index) => {
      let doms = document.createElement('div')
      data.gamePlayer[index].card.forEach(i => {
        let li = document.createElement('li')
        li.innerHTML = `${setCrad(i.type)}--${i.count}`
        li.setAttribute('count', i.count)
        li.setAttribute('types', i.type)
        doms.appendChild(li)
      })
      v.innerHTML = ''
      v.appendChild(doms)
    })

  })

  selectCrd.addEventListener('click', (e) => {
    // 选择卡牌
    let data = {
      count: e.target.getAttribute('count'),
      type: e.target.getAttribute('types')
    }
    let selectIndex = getIsSelect(selectDom, data)
    if (selectIndex === -1) {
      if (selectDom.length < 3) {
        addClass(e.target, 'pitchOn')
        selectDom.push(data)
     }
    } else {
      remClass(e.target, 'pitchOn')
      selectDom.splice(selectIndex, 1)
    }
    console.log(selectDom)
  })

</script>

</html>